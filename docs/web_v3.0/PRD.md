# FA Report Analyzer v3.0 - Web 版 PRD
## Product Requirements Document

**版本**: v3.0
**文件日期**: 2025-12-01
**狀態**: Draft (待確認)

---

## 1. 產品概述

### 1.1 產品願景
將 FA Report Analyzer v2.0 從命令行工具升級為基於 Web 的企業級應用，提供更友好的用戶界面和更強大的功能，讓工程師能夠透過瀏覽器快速上傳和分析 FA 報告。

### 1.2 目標用戶
- FA 工程師（主要用戶）
- 品質管理人員
- 技術主管和管理層
- 需要快速評估 FA 報告品質的相關人員

### 1.3 核心價值
- **易用性**: 無需安裝 Python 環境，瀏覽器即可使用
- **即時性**: 上傳即分析，即時查看結果
- **可追溯**: 歷史記錄管理，方便查閱過往分析
- **彈性**: 支援多種 LLM 後端切換
- **安全**: 文件加密存儲，使用者權限管理

---

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 文件上傳與管理
**優先級**: P0 (Must Have)

**功能描述**:
- 拖拽或點擊上傳文件
- 支援格式: PDF, DOCX, PPTX, TXT, JPG, PNG, GIF, WEBP
- 單檔案大小限制: 50MB
- 上傳進度顯示
- 文件預覽功能（可選）

**驗收標準**:
- [ ] 支援拖拽上傳
- [ ] 支援多種文件格式
- [ ] 顯示上傳進度條
- [ ] 文件大小超限時顯示錯誤提示
- [ ] 不支援格式顯示友好錯誤訊息

#### 2.1.2 後端配置管理
**優先級**: P0 (Must Have)

**功能描述**:
- LLM 後端選擇 (Ollama / OpenAI / Anthropic)
- 模型選擇（根據後端動態顯示）
- API Key 配置（加密存儲）
- 圖片分析開關（--skip-images）
- 配置保存與讀取

**驗收標準**:
- [ ] 下拉選單選擇後端
- [ ] 根據後端顯示對應模型列表
- [ ] API Key 輸入框（密碼型態）
- [ ] 配置可保存並在下次使用
- [ ] Ollama 後端不需要 API Key

#### 2.1.3 分析執行與進度追蹤
**優先級**: P0 (Must Have)

**功能描述**:
- 非同步任務處理
- 實時進度更新
- 任務狀態管理（排隊/進行中/完成/失敗）
- 分析取消功能
- 錯誤處理與提示

**驗收標準**:
- [ ] 點擊「開始分析」後立即返回任務 ID
- [ ] WebSocket 或 SSE 推送進度更新
- [ ] 顯示當前分析階段（讀取文件/AI 分析/生成報告）
- [ ] 可中途取消分析任務
- [ ] 錯誤時顯示詳細錯誤訊息

#### 2.1.4 結果展示與下載
**優先級**: P0 (Must Have)

**功能描述**:
- 總分與等級視覺化（圖表）
- 6 維度評分雷達圖
- 詳細評分表格
- 優點與改進建議列表
- 完整報告下載（TXT/PDF/JSON）

**驗收標準**:
- [ ] 總分以大字號突出顯示
- [ ] 等級使用顏色區分（A-綠/B-藍/C-黃/D-橙/F-紅）
- [ ] 雷達圖可視化 6 維度得分
- [ ] 表格清晰展示各維度評分與評語
- [ ] 支援下載 TXT/PDF/JSON 三種格式

#### 2.1.5 歷史記錄管理
**優先級**: P1 (Should Have)

**功能描述**:
- 分析歷史列表
- 搜尋與篩選（按日期/檔名/分數）
- 歷史報告重新查看
- 歷史報告刪除
- 批量操作

**驗收標準**:
- [ ] 列表顯示最近 50 筆記錄
- [ ] 可按日期/檔名/分數排序
- [ ] 點擊記錄可查看完整報告
- [ ] 支援單筆和批量刪除
- [ ] 刪除前需確認

### 2.2 進階功能（未來版本）

#### 2.2.1 用戶認證與權限管理
**優先級**: P2 (Nice to Have)

- 用戶註冊/登入/登出
- 多用戶隔離（每個用戶只能看到自己的記錄）
- 角色管理（管理員/普通用戶）
- API Key 個人化管理

#### 2.2.2 批量分析
**優先級**: P2 (Nice to Have)

- 多檔案同時上傳
- 批量分析排程
- 批量結果匯出

#### 2.2.3 報告比較功能
**優先級**: P2 (Nice to Have)

- 選擇 2-3 份報告進行比較
- 並排顯示評分差異
- 生成比較分析報告

---

## 3. 技術需求

### 3.1 前端技術棧
- **核心**: 純 HTML5 + CSS3 + Vanilla JavaScript (ES6+)
- **UI 框架**: Bootstrap 5 (CDN) 或 Tailwind CSS (CDN)
- **圖表**: ECharts (CDN) 或 Chart.js (CDN)
- **HTTP 客戶端**: Fetch API (原生)
- **實時通訊**: WebSocket API (原生) / EventSource (SSE)
- **無需**: Node.js, npm, 打包工具

### 3.2 後端技術棧
- **框架**: FastAPI 0.104+
- **非同步任務**: Celery + Redis / FastAPI Background Tasks
- **資料庫**: SQLite (開發) / PostgreSQL (生產)
- **ORM**: SQLAlchemy 2.0+
- **檔案存儲**: 本地檔案系統 / MinIO / AWS S3
- **API 文件**: FastAPI 自動生成 Swagger/ReDoc

### 3.3 部署架構
- **容器化**: Docker + Docker Compose
- **反向代理**: Nginx
- **HTTPS**: Let's Encrypt
- **監控**: 基本日誌記錄（未來可擴展 Prometheus + Grafana）

### 3.4 安全需求
- API Key 加密存儲（Fernet 加密）
- 文件上傳防毒掃描（ClamAV，可選）
- CORS 設定
- 檔案類型白名單驗證
- 檔案大小限制
- Rate Limiting（防止濫用）

---

## 4. 非功能性需求

### 4.1 性能需求
- 文件上傳響應時間 < 2s（50MB 文件）
- AI 分析時間取決於 LLM 後端（通常 10-60s）
- 頁面首次載入時間 < 3s
- 支援同時 10 個用戶使用

### 4.2 可用性需求
- 系統正常運行時間 > 99%（單機部署）
- 優雅的錯誤處理和用戶提示
- 多語言支援（v3.0 僅繁體中文）

### 4.3 可維護性需求
- 代碼覆蓋率 > 70%
- API 文件自動生成
- 清晰的日誌記錄
- 模組化設計，易於擴展

### 4.4 相容性需求
- 瀏覽器支援: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- 行動裝置瀏覽器支援（響應式設計）
- 向下相容 v2.0 的核心分析邏輯

---

## 5. 用戶故事

### 5.1 基本分析流程
**作為** FA 工程師
**我想要** 透過網頁上傳 FA 報告並獲得 AI 評分
**以便** 快速了解報告品質而無需安裝任何軟體

**驗收標準**:
1. 訪問網頁後看到清晰的上傳界面
2. 拖拽 PDF 文件到上傳區域
3. 選擇使用 Ollama 本地模型
4. 點擊「開始分析」按鈕
5. 看到進度條顯示分析進度
6. 分析完成後自動跳轉結果頁面
7. 看到總分、等級、雷達圖和詳細評分
8. 可下載完整評估報告

### 5.2 配置管理
**作為** 用戶
**我想要** 保存我的 LLM 配置
**以便** 下次使用時不需要重新輸入 API Key

**驗收標準**:
1. 在設定頁面選擇 OpenAI 後端
2. 輸入 API Key
3. 點擊「保存配置」
4. 關閉瀏覽器後重新開啟
5. 配置仍然保存（API Key 加密顯示）

### 5.3 歷史記錄查詢
**作為** 技術主管
**我想要** 查看團隊過去分析的所有報告
**以便** 追蹤報告品質趨勢

**驗收標準**:
1. 點擊「歷史記錄」頁面
2. 看到按時間排序的分析記錄列表
3. 可按檔名搜尋特定報告
4. 可按分數篩選（例如只看 A 級報告）
5. 點擊記錄可查看完整評估結果

---

## 6. 介面設計指引

### 6.1 主要頁面結構
1. **首頁/上傳頁面**
   - 頂部導航欄（Logo, 導航連結, 設定按鈕）
   - 中央上傳區域（大型拖拽區）
   - 底部最近分析記錄（快速訪問）

2. **分析進度頁面**
   - 進度條與百分比
   - 當前執行階段提示
   - 取消按鈕

3. **結果展示頁面**
   - 頂部總分卡片（大字號顯示分數和等級）
   - 雷達圖區域
   - 6 維度詳細表格
   - 優點列表
   - 改進建議列表
   - 總評區域
   - 下載按鈕組

4. **歷史記錄頁面**
   - 搜尋/篩選欄
   - 記錄列表（表格或卡片式）
   - 分頁控制

5. **設定頁面**
   - LLM 後端配置
   - 系統偏好設定

### 6.2 設計原則
- **簡潔**: 每個頁面專注單一任務
- **直觀**: 使用常見的 UI 模式
- **回饋**: 所有操作都有即時視覺反饋
- **容錯**: 錯誤訊息清晰且提供解決建議

---

## 7. API 端點規劃

### 7.1 核心端點

```
POST   /api/v1/upload           上傳文件
POST   /api/v1/analyze          開始分析（返回任務 ID）
GET    /api/v1/analyze/{task_id} 查詢分析狀態
GET    /api/v1/result/{task_id}  獲取分析結果
DELETE /api/v1/analyze/{task_id} 取消/刪除分析任務

GET    /api/v1/history          獲取歷史記錄列表
GET    /api/v1/history/{id}     獲取單筆歷史記錄
DELETE /api/v1/history/{id}     刪除歷史記錄

POST   /api/v1/config           保存配置
GET    /api/v1/config           獲取配置

GET    /api/v1/models           獲取可用模型列表
GET    /api/v1/health           健康檢查

WebSocket /ws/analyze/{task_id} 實時進度推送
```

### 7.2 數據模型

**AnalysisTask**
```python
{
  "task_id": "uuid",
  "filename": "report.pdf",
  "status": "pending|processing|completed|failed",
  "progress": 0-100,
  "backend": "ollama|openai|anthropic",
  "model": "llama3.1:latest",
  "skip_images": false,
  "created_at": "ISO8601",
  "completed_at": "ISO8601|null",
  "error": "error message|null"
}
```

**AnalysisResult**
```python
{
  "task_id": "uuid",
  "total_score": 85.5,
  "grade": "B",
  "dimension_scores": {...},
  "strengths": [...],
  "improvements": [...],
  "summary": "...",
  "analysis_time": 45.2  # seconds
}
```

---

## 8. 開發里程碑

### Phase 1: MVP (v3.0.0) - 2-3 週
- 基本文件上傳與分析
- 後端配置管理
- 結果展示（基本表格，無圖表）
- Ollama 後端支援

### Phase 2: Enhanced (v3.1.0) - 1-2 週
- 圖表可視化（雷達圖）
- OpenAI/Anthropic 後端支援
- 歷史記錄功能
- WebSocket 實時進度

### Phase 3: Production Ready (v3.2.0) - 1-2 週
- Docker 容器化
- 安全性增強
- 性能優化
- 完整測試覆蓋

### Phase 4: Advanced Features (v4.0.0) - 未來規劃
- 用戶認證系統
- 批量分析
- 報告比較
- 多語言支援

---

## 9. 風險與挑戰

### 9.1 技術風險
- **LLM 回應時間不穩定**: 使用非同步任務和超時機制
- **大文件處理**: 實施文件大小限制和流式上傳
- **並發處理**: 使用任務隊列管理並發數量

### 9.2 安全風險
- **API Key 洩漏**: 使用加密存儲和環境變數
- **惡意文件上傳**: 文件類型驗證和大小限制
- **未授權訪問**: 實施 CORS 和 Rate Limiting

### 9.3 用戶體驗風險
- **長時間等待**: 提供清晰的進度指示和預估時間
- **錯誤處理**: 友好的錯誤訊息和恢復建議

---

## 10. 成功指標

### 10.1 功能指標
- [ ] 支援所有 v2.0 的文件格式
- [ ] 分析準確度與 v2.0 一致
- [ ] 完成率 > 95%（上傳的文件成功分析的比例）

### 10.2 性能指標
- [ ] 頁面載入時間 < 3s
- [ ] 文件上傳響應 < 2s
- [ ] 支援 10 並發用戶

### 10.3 用戶體驗指標
- [ ] 用戶完成一次完整分析流程 < 5 分鐘（含等待 AI 分析時間）
- [ ] 錯誤訊息可理解性 > 90%（用戶調查）

---

## 11. 附錄

### 11.1 術語表
- **FA**: Failure Analysis（失效分析）
- **LLM**: Large Language Model（大型語言模型）
- **MVP**: Minimum Viable Product（最小可行產品）
- **SSE**: Server-Sent Events（伺服器推送事件）

### 11.2 參考資源
- FastAPI 官方文件: https://fastapi.tiangolo.com/
- v2.0 原始碼: `fa_report_analyzer_v2.py`
- 評估標準: 6 維度評估框架（見 CLAUDE.md）

---

**文件核准**:
- [ ] 產品負責人
- [ ] 技術負責人
- [ ] 用戶代表

**下一步**:
- [ ] 確認 PRD
- [ ] 檢視實施計劃
- [ ] 開始開發
